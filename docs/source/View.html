<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='org-puremvc-js-multicore-core-View-method-constructor'><span id='org-puremvc-js-multicore-core-View'>/**
</span></span> * @class org.puremvc.js.multicore.core.View
 * 
 * A Multiton View implementation.
 * 
 * In PureMVC, the View class assumes these responsibilities
 * 
 * - Maintain a cache of {@link org.puremvc.js.multicore.patterns.mediator.Mediator Mediator}
 *   instances.
 * 
 * - Provide methods for registering, retrieving, and removing 
 *   {@link org.puremvc.js.multicore.patterns.mediator.Mediator Mediator}.
 * 
 * - Notifiying {@link org.puremvc.js.multicore.patterns.mediator.Mediator Mediator} 
 *   when they are registered or removed.
 * 
 * - Managing the observer lists for each 
 *   {@link org.puremvc.js.multicore.patterns.observer.Notification Notification}  
 *   in the application.
 * 
 * - Providing a method for attaching 
 *   {@link org.puremvc.js.multicore.patterns.observer.Observer Observer} to an 
 *   {@link org.puremvc.js.multicore.patterns.observer.Notification Notification}'s 
 *   observer list.
 * 
 * - Providing a method for broadcasting a 
 *   {@link org.puremvc.js.multicore.patterns.observer.Notification Notification}.
 * 
 * - Notifying the 
 *   {@link org.puremvc.js.multicore.patterns.observer.Observer Observer}s 
 *   of a given 
 *   {@link org.puremvc.js.multicore.patterns.observer.Notification Notification} 
 *   when it broadcast.
 * 
 * This View implementation is a Multiton, so you should not call the 
 * constructor directly, but instead call the static Multiton 
 * Factory #getInstance method.
 * 
 * @param {string} key
 * @constructor
 * @throws {Error} 
 *  if instance for this Multiton key has already been constructed
 */
function View(key)
{
    if(View.instanceMap[key] != null)
    {
        throw new Error(View.MULTITON_MSG);
    };

    this.multitonKey = key;
    View.instanceMap[this.multitonKey] = this;
    this.mediatorMap = [];
    this.observerMap = [];
    this.initializeView();
};

<span id='org-puremvc-js-multicore-core-View-method-initializeView'>/**
</span> * @protected
 * Initialize the Singleton View instance
 * 
 * Called automatically by the constructor, this is your opportunity to
 * initialize the Singleton instance in your subclass without overriding the
 * constructor
 * 
 * @return {void}
 */
View.prototype.initializeView = function()
{
    return;
};

<span id='org-puremvc-js-multicore-core-View-method-getInstance'>/**
</span> * View Singleton Factory method.
 * 
 * @return {org.puremvc.js.multicore.core.View}
 *  The Singleton instance of View
 */
View.getInstance = function(key)
{
    if(View.instanceMap[key] == null)
    {
        View.instanceMap[key] = new View(key);
    };

    return View.instanceMap[key];
};

<span id='org-puremvc-js-multicore-core-View-method-registerObserver'>/**
</span> * Register an Observer to be notified of Notifications with a given name
 * 
 * @param {string} notificationName
 *  The name of the Notifications to notify this Observer of
 * @param {org.puremvc.js.multicore.patterns.observer.Observer} observer
 *  The Observer to register.
 * @return {void}
 */
View.prototype.registerObserver = function(notificationName, observer)
{
    if(this.observerMap[notificationName] != null)
    {
        this.observerMap[notificationName].push(observer);
    }
    else
    {
        this.observerMap[notificationName] = [observer];
    }
};

<span id='org-puremvc-js-multicore-core-View-method-notifyObservers'>/**
</span> * Notify the Observersfor a particular Notification.
 * 
 * All previously attached Observers for this Notification's
 * list are notified and are passed a reference to the INotification in 
 * the order in which they were registered.
 * 
 * @param {org.puremvc.js.multicore.patterns.observer.Notification} notification
 *  The Notification to notify Observers of
 * @return {void}
 */
View.prototype.notifyObservers = function(notification)
{
    // SIC
    if(this.observerMap[notification.getName()] != null)
    {
        var observers_ref = this.observerMap[notification.getName()], observers = [], observer

        for(var i = 0; i &lt; observers_ref.length; i++)
        {
            observer = observers_ref[i];
            observers.push(observer);
        }

        for(var i = 0; i &lt; observers.length; i++)
        {
            observer = observers[i];
            observer.notifyObserver(notification);
        }
    }
};

<span id='org-puremvc-js-multicore-core-View-method-removeObserver'>/**
</span> * Remove the Observer for a given notifyContext from an observer list for
 * a given Notification name
 * 
 * @param {string} notificationName
 *  Which observer list to remove from
 * @param {Object} notifyContext
 *  Remove the Observer with this object as its notifyContext
 * @return {void}
 */
View.prototype.removeObserver = function(notificationName, notifyContext)
{
    // SIC
    var observers = this.observerMap[notificationName];
    for(var i = 0; i &lt; observers.length; i++)
    {
        if(observers[i].compareNotifyContext(notifyContext) == true)
        {
            observers.splice(i, 1);
            break;
        }
    }

    if(observers.length == 0)
    {
        delete this.observerMap[notificationName];
    }
};

<span id='org-puremvc-js-multicore-core-View-method-registerMediator'>/**
</span> * Register a Mediator instance with the View.
 * 
 * Registers the Mediator so that it can be retrieved by name,
 * and further interrogates the Mediator for its 
 * {@link org.puremvc.js.multicore.patterns.mediator.Mediator#listNotificationInterests interests}.
 *
 * If the Mediator returns any Notification
 * names to be notified about, an Observer is created encapsulating 
 * the Mediator instance's 
 * {@link org.puremvc.js.multicore.patterns.mediator.Mediator#handleNotification handleNotification}
 * method and registering it as an Observer for all Notifications the 
 * Mediator is interested in.
 * 
 * @param {org.puremvc.js.multicore.patterns.mediator.Mediator} 
 *  a reference to the Mediator instance
 */
View.prototype.registerMediator = function(mediator)
{
    if(this.mediatorMap[mediator.getMediatorName()] != null)
    {
        return;
    }

    mediator.initializeNotifier(this.multitonKey);
    // register the mediator for retrieval by name
    this.mediatorMap[mediator.getMediatorName()] = mediator;

    // get notification interests if any
    var interests = mediator.listNotificationInterests();

    // register mediator as an observer for each notification
    if(interests.length &gt; 0)
    {
        // create observer referencing this mediators handleNotification method
        var observer = new Observer(mediator.handleNotification, mediator);
        for(var i = 0; i &lt; interests.length; i++)
        {
            this.registerObserver(interests[i], observer);
        }
    }

    mediator.onRegister();
}

<span id='org-puremvc-js-multicore-core-View-method-retrieveMediator'>/**
</span> * Retrieve a Mediator from the View
 * 
 * @param {string} mediatorName
 *  The name of the Mediator instance to retrieve
 * @return {org.puremvc.js.multicore.patterns.mediator.Mediator}
 *  The Mediator instance previously registered with the given mediatorName
 */
View.prototype.retrieveMediator = function(mediatorName)
{
    return this.mediatorMap[mediatorName];
};

<span id='org-puremvc-js-multicore-core-View-method-removeMediator'>/**
</span> * Remove a Mediator from the View.
 * 
 * @param {string} mediatorName
 *  Name of the Mediator instance to be removed
 * @return {org.puremvc.js.multicore.patterns.mediator.Mediator}
 *  The Mediator that was removed from the View
 */
View.prototype.removeMediator = function(mediatorName)
{
    var mediator = this.mediatorMap[mediatorName];
    if(mediator)
    {
        // for every notification the mediator is interested in...
        var interests = mediator.listNotificationInterests();
        for(var i = 0; i &lt; interests.length; i++)
        {
            // remove the observer linking the mediator to the notification
            // interest
            this.removeObserver(interests[i], mediator);
        }

        // remove the mediator from the map
        delete this.mediatorMap[mediatorName];

        // alert the mediator that it has been removed
        mediator.onRemove();
    }

    return mediator;
};

<span id='org-puremvc-js-multicore-core-View-method-hasMediator'>/**
</span> * Check if a Mediator is registered or not.
 * 
 * @param {string} mediatorName
 * @return {boolean}
 *  Whether a Mediator is registered with the given mediatorname
 */
View.prototype.hasMediator = function(mediatorName)
{
    return this.mediatorMap[mediatorName] != null;
};

<span id='org-puremvc-js-multicore-core-View-method-removeView'>/**
</span> * Remove a View instance
 * 
 * @return {void}
 */
View.removeView = function(key)
{
    delete View.instanceMap[key];
};

<span id='org-puremvc-js-multicore-core-View-property-mediatorMap'>/**
</span> * @ignore
 * The Views internal mapping of mediator names to mediator instances
 *
 * @type Array
 * @protected
 */
View.prototype.mediatorMap = null;

<span id='org-puremvc-js-multicore-core-View-property-observerMap'>/**
</span> * @ignore
 * The Views internal mapping of Notification names to Observer lists
 *
 * @type Array
 * @protected
 */
View.prototype.observerMap = null;

<span id='org-puremvc-js-multicore-core-View-property-instanceMap'>/**
</span> * @ignore
 * The internal map used to store multiton View instances
 *
 * @type Array
 * @protected
 */
View.instanceMap = [];

<span id='org-puremvc-js-multicore-core-View-property-multitonKey'>/**
</span> * @ignore
 * The Views internal multiton key.
 *
 * @type string
 * @protected
 */
View.prototype.multitonKey = null;

<span id='org-puremvc-js-multicore-core-View-static-property-MULTITON_MSG'>/**
</span> * @ignore
 * The error message used if an attempt is made to instantiate View directly
 *
 * @type string
 * @protected
 * @const
 * @static
 */
View.MULTITON_MSG = &quot;View instance for this Multiton key already constructed!&quot;;
</pre>
</body>
</html>
